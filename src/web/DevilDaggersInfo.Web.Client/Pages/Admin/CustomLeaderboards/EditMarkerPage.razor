@page "/admin/custom-leaderboards/edit-marker"
@inherits BaseAdminPage
@using DevilDaggersInfo.Web.Client.Components.Admin
@using DevilDaggersInfo.Web.Client.Enums

<AdminAuthorizer Base="this" RequiredRole="@Roles.CustomLeaderboards">
	<Heading Title="Admin - Edit Marker" />

	<InputWrapper Label="Name"><SearchDropdown TKey=string Values="_values" Converter="s => s" @bind-Value="@_markerName" /></InputWrapper>
	<InputWrapper Label="Value (decimal)"><InputNumber class="admin-input" @bind-Value="_markerValue" /></InputWrapper>

	<p class="font-bold">
		After editing, please be sure to test if submitting a run via DDCL works.
	</p>

	<button class="btn btn-gray p-1" @onclick="OnValidSubmit">Edit marker</button>
</AdminAuthorizer>

@code
{
	private Dictionary<string, string> _values = new();

	private string _markerName = "WindowsSteam";
	private long _markerValue;

	protected override async Task OnInitializedAsync()
	{
		_values = (await Http.GetMarkers()).ToDictionary(s => s, s => s);
	}

	private async Task OnValidSubmit()
	{
		try
		{
			HttpResponseMessage hrm = await Http.EditMarker(_markerName, _markerValue);

			if (hrm.StatusCode == HttpStatusCode.OK)
				NavigationManager.NavigateTo("/admin/custom-leaderboards");
		}
		catch (AccessTokenNotAvailableException exception)
		{
			exception.Redirect();
		}
	}
}
