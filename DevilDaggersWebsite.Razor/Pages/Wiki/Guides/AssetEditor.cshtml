@page
@{
	ViewData["Title"] = "Asset Editor Guide";
}

<header>
	<h1>@ViewData["Title"]</h1>
</header>

<main role="main">
	<p>
		This page will guide you through the creation of custom asset mods for Devil Daggers. This guide is aimed at Devil Daggers Asset Editor 0.56.5.0, and will be inaccurate for any older versions. If you are not running the latest version, it is highly recommended to <a asp-page="/Tools/DevilDaggersAssetEditor">download the latest version</a>.
	</p>

	<h2>Basic information</h2>

	<p>
		There is some basic information that you need to know in order to understand how to create asset mods for Devil Daggers.
	</p>

	<h3>Binaries</h3>
	<p>
		Devil Daggers uses custom binary formats to read asset data from asset files. There are 3 of these files that contain assets:
	</p>
	<ul>
		<li><span class="path">devildaggers\res\audio</span> contains all audio</li>
		<li><span class="path">devildaggers\res\dd</span> contains all textures, all models, and most shaders</li>
		<li><span class="path">devildaggers\core\core</span> contains UI-related shaders</li>
	</ul>
	<p>
		Where <span class="path">devildaggers</span> is the installation folder for Devil Daggers. The default location for this folder is <span class="path">C:\Program Files (x86)\Steam\steamapps\common\devildaggers</span>.
	</p>
	<p>
		All of these files can be modded using <a asp-page="/Tools/DevilDaggersAssetEditor">Devil Daggers Asset Editor</a> (also known as DDAE). These files are referred to as "binaries" in the application. If you're interested how these files are structured and how DDAE operates with them, I've documented how they work <a href="//github.com/NoahStolk/DevilDaggersAssetEditor/blob/master/DOCUMENTATION.md">here</a>.
	</p>
	<p>
		As of the V3.1 update, Devil Daggers allows partial mods for the "audio" and "dd" binaries. This means that you don't need to create these entire binary anymore, but can instead create a "partial" binary containing only the modded assets. This is useful because it makes the files much smaller. The partial mods are saved in the <span class="path">devildaggers\mods</span> folder and their file name must be begin with the binary file type they are targetting, for example "dd_blue_gem", or "audio_trumpet_gigapedes". This feature also allows you to stack multiple partial mods and play them at once. The mods are loaded alphabetically, so if you have two partial mods replacing the same assets, the last one will actually replace the asset. For example, if you have two texture mods named "dd_blue_gem" and "dd_yellow_gem", which both change the color of the gem texture, "dd_yellow_gem" will be the effective one.
	</p>
	<p>
		Note that partial mods are not supported for "core" mods.
	</p>

	<h3>Asset types</h3>
	<p>
		There are 5 types of assets that Devil Daggers uses:
	</p>
	<ul>
		<li>Audio (.wav)</li>
		<li>Model bindings (.txt)</li>
		<li>Models (.obj)</li>
		<li>Shaders (.glsl)</li>
		<li>Textures (.png)</li>
	</ul>

	<h2>The asset editor</h2>

	<p>
		I've created <a asp-page="/Tools/DevilDaggersAssetEditor">Devil Daggers Asset Editor</a> to make it easier to mod the game's assets.
	</p>

	<p>
		<img class="img-responsive" src="~/images/Tools/DevilDaggersAssetEditor.png" />
	</p>

	<p>
		The first thing you will see when you open DDAE is a list of assets. These are all the default assets present in the binaries. Note that there are 6 different tabs at the top:
	</p>
	<p>
		<ul>
			<li>audio/Audio</li>
			<li>core/Shaders</li>
			<li>dd/Models</li>
			<li>dd/Model Bindings</li>
			<li>dd/Shaders</li>
			<li>dd/Textures</li>
		</ul>
	</p>
	<p>
		DDAE orders the assets by binary file, and then by asset type. So "dd/Models" will contain all model assets present in the "dd" file.
	</p>

	<h3>Mod files</h3>
	<p>
		Since binaries can be huge, DDAE works with mod files, which, instead of holding all the raw asset data, are basically just lists of user-specified asset paths. Mod files have the extension .ddae and are written in JSON format, so they can be opened using a text editor. Note that if you change the locations of assets, it will break the mod file. You can open the mod file using a text editor and globally replace all the paths with the new path to fix it (unless you also renamed the files themselves).
	</p>

	<h2>How to create a mod</h2>

	<h3>Extracting the original assets</h3>
	<p>
		It is useful to extract the original assets so you know what assets you can mod.
	</p>

	<ol>
		<li>
			It is recommended to set the Devil Daggers root folder in the program, so it can locate the files. Go to "Options > Settings" and set "Devil Daggers root folder" to the directory containing "dd.exe". Again, this is <span class="path">C:\Program Files (x86)\Steam\steamapps\common\devildaggers</span> by default. If you're not sure where Devil Daggers is installed, you can launch Devil Daggers and click "Auto-detect" and DDAE will automatically detect the correct directory.
			<img class="img-responsive" src="~/images/Tools/DevilDaggersAssetEditor-Settings.png" />
		</li>
		<li>Now that the settings are correct, we can extract the binaries. Click on "File > Extract binaries".</li>
		<li>
			A new window will appear, and if the Devil Daggers root folder is correct, there should be 4 paths pointing to all the asset files. If the paths are incorrect, make sure to set them to the correct asset files using the "Browse" buttons.
			<img class="img-responsive" src="~/images/Tools/DevilDaggersAssetEditor-Extract-Binaries.png" />
		</li>
		<li>Once the paths are correct, click on "Browse", under "Assets output directory", to set the folder where you want the original assets to be extracted to.</li>
		<li>Click on the "Extract binaries" button. This will create the asset files in the assets output directory.</li>
	</ol>

	<h3>Making your own mod</h3>

	<h4>Step 1: Modifying assets</h4>
	<ol>
		<li>Go to "File > New mod" to create a new mod. Select an asset from the lists you wish to mod and click the "Browse" button on the right to replace it with a custom asset.</li>
		<li>In the open file dialog, select a compatible file. There are some requirements for certain assets, such as audio files. These can be found under <a href="#compatibility">Compatibility</a> at the bottom of the page. After you've done that, your asset should show up in the lists. Most assets can also be previewed by selecting them.</li>
	</ol>

	<h4>Step 2: Saving your mod</h4>
	<ol>
		<li>Since you may want to work on this mod again, it's a good idea to save it to your computer. Go to "File > Save mod" to do so.</li>
		<li>In the save file dialog, select a folder that will contain your mod files. Give your mod file a name and save it inside the folder. Your mod should now be saved as a .ddae file containing the paths to the assets you specified in the editor.</li>
	</ol>
	<p>
		Note: You can set a default path for mod files in "Options > Settings" for convenience. This is purely optional; this path will be used as default location when opening mod files.
	</p>

	<h4>Step 3: Making your mod into a binary to be played in Devil Daggers</h4>
	<ol>
		<li>To test your mod, make sure it's opened. If it's not, open it by going to "File > Open mod".</li>
		<li>You will now see all your custom files being listed in the asset editor. To turn these files into a binary, go to "File > Make binaries".</li>
		<li>
			A new window will appear. Type the name of the mod in the text box under "Mod name". If your settings are correct, the paths should now automatically point to the "mods" folder.
			<img class="img-responsive" src="~/images/Tools/DevilDaggersAssetEditor-Make-Binaries.png" />
		</li>
		<li>Click "Make binaries".</li>
		<li>Launch Devil Daggers to see if it starts up correctly. If it does not, a list of common known causes can be found under <a href="#crashes">Crashes</a>.</li>
	</ol>
	<p>
		Note: When you want to test a new version of your mod, you will need to restart Devil Daggers after making the binary again, as they are only loaded when Devil Daggers starts up.
	</p>

	<h2 id="crashes">Crashes</h2>
	<p>
		Devil Daggers will crash if there's something wrong with your mod. DDAE should automatically display an error message in some cases, such as when it cannot properly convert your model to the custom binary format Devil Daggers uses for models. However, some causes are uncaught. Here's a list of some other known causes that will cause Devil Daggers to crash:
	</p>
	<ul>
		<li>You have replaced one of the original files instead of created a new one in the "mods" folder. It is never recommended to modify the original files and it will most likely crash the game on start up.</li>
		<li>There might be something wrong with one of your custom audio asset. Be sure to check if all files are compatible under <a href="#compatibility">Compatibility</a>.</li>
		<li>Your custom shader asset might not compile.</li>
	</ul>
	<p>
		Future versions of DDAE should include more warnings and error messages for these issues.
	</p>

	<h2 id="compatibility">Compatibility</h2>

	<h3>Audio</h3>
	<p>
		Only .wav files are supported. The .wav files need to meet the following requirements in order to play correctly:
	</p>
	<ul>
		<li>2 channels</li>
		<li>44.1kHz sample rate</li>
		<li>16-bit PCM format</li>
	</ul>
	<p>
		You can convert the .wav files to the correct format using software such as Audacity.
	</p>

	<h3>Textures</h3>
	<p>
		Only .png files are supported. The files can be whatever dimension, though having files larger than 512x512 is not recommended since it will make the binary huge. Transparency is supported and used for UI textures, splash screens, etc, but does not work for model textures by default.
	</p>

	<h3>Models</h3>
	<p>
		Only .obj files are supported. The files can consist of triangles or quads, though NGons are not supported for now. You can create models using software such as Blender.
	</p>

	<h2>Miscellaneous information</h2>
	<ul>
		<li>The Devil Daggers title screen music seems to start playing at some hardcoded offset.</li>
	</ul>
</main>

@section Styles {
	<link rel='stylesheet' href='~/styles/asset-guide.css' asp-append-version="true" />
}
