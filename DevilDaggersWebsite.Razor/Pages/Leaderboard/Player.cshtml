@page
@using DevilDaggersCore.Utils
@model DevilDaggersWebsite.Razor.Pages.Leaderboard.PlayerModel
@{
	string? username = Model.Entry?.Username;
	ViewData["Title"] = string.IsNullOrEmpty(username) ? "Player" : username;
}

<header>
	<h1>@ViewData["Title"]</h1>
</header>

<main role="main">
	@if (Model.Entry == null)
	{
		<p>Failed to retrieve player with ID @Model.PlayerId.</p>
		return;
	}

	<div>Currently rank @Model.Entry.Rank</div>

	<h2>Personal Best</h2>
	<div class="flex-container flex-space-evenly icon-list">
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Time'><img src="~/images/Icons/stopwatchx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.Time.FormatTimeInteger(false)</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Kills'><img src="~/images/Icons/daggerx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.Kills.ToString(FormatUtils.LeaderboardIntFormat)</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Gems'><img src="~/images/Icons/gemx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.Gems.ToString(FormatUtils.LeaderboardIntFormat)</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Accuracy'><img src="~/images/Icons/crosshairx4.png" /></div>
			<div>
				<span data-toggle="tooltip" title="@FormatUtils.FormatDaggersInt32(Model.Entry.DaggersHit, Model.Entry.DaggersFired, false)" class="devil stat-text leaderboard-tooltip"><span class="devil">@Model.Entry.Accuracy.ToString(FormatUtils.AccuracyFormat)</span></span>
			</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Death type'><img src="~/images/Icons/skullx4.png" /></div>
			<div class="stat-text" style="color: #@Model.Death?.ColorCode">@(Model.Death?.Name)</div>
		</div>
	</div>

	<h2>Statistics</h2>
	<div class="flex-container flex-space-evenly icon-list">
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Total time'><img src="~/images/Icons/stopwatchx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.TimeTotal.FormatTimeInteger(true)</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Total kills'><img src="~/images/Icons/daggerx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.KillsTotal.ToString(FormatUtils.LeaderboardIntFormat)</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Total gems'><img src="~/images/Icons/gemx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.GemsTotal.ToString(FormatUtils.LeaderboardIntFormat)</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Total accuracy'><img src="~/images/Icons/crosshairx4.png" /></div>
			<div>
				<span data-toggle="tooltip" title="@FormatUtils.FormatDaggersUInt64(Model.Entry.DaggersHitTotal, Model.Entry.DaggersFiredTotal, false)" class="devil stat-text leaderboard-tooltip"><span class="devil">@Model.Entry.AccuracyTotal.ToString(FormatUtils.AccuracyFormat)</span></span>
			</div>
		</div>
		<div class="flex-container flex-space-evenly">
			<div class="icon-large" data-toggle='tooltip' title='Total deaths'><img src="~/images/Icons/skullx4.png" /></div>
			<div class="devil stat-text">@Model.Entry.DeathsTotal.ToString(FormatUtils.LeaderboardIntFormat)</div>
		</div>
	</div>

	<h2>History</h2>
	<div class="row">
		@*Past usernames, highest rank ever*@
	</div>

	@if (Model.HasValidTop100Graph)
	{
		<h2>Top 100 progression</h2>
		<p>
			Note that the graph data is based on the <a asp-page="/Leaderboard/History">Leaderboard History</a>, and might therefore be incomplete.
		</p>
		<p>
			Also note that the graph data is only based on a player's highscores; the rank and username do not update until the next top 100 highscore.
		</p>

		<div class="chart" id="user-progression-chart">
			<table class="highlighter" id="user-progression-highlighter">
				<tr><td>Date</td><td id="h-date"></td></tr>
				<tr><td>Rank</td><td id="h-rank"></td></tr>
				<tr><td>Time</td><td id="h-time"></td></tr>
				<tr><td>Username</td><td id="h-username"></td></tr>
				<tr><td>Gems</td><td id="h-gems"></td></tr>
				<tr><td>Kills</td><td id="h-kills"></td></tr>
				<tr><td>Accuracy</td><td id="h-accuracy"></td></tr>
				<tr><td>Death type</td><td id="h-death-type"></td></tr>
			</table>
		</div>

		<h2>Activity</h2>
		<div class="chart" id="user-activity-chart">
			<table class="highlighter" id="user-activity-highlighter">
				<tr><td>Period</td><td id="h-activity-date"></td></tr>
				<tr><td>Approximate deaths per day</td><td id="h-activity-deaths-per-day"></td></tr>
				<tr><td>Total deaths</td><td id="h-activity-deaths"></td></tr>
			</table>
		</div>
	}
</main>

@section Scripts {
	<script defer src='~/plugins/jqPlot/jquery.jqplot.min.js' asp-append-version='true'></script>
	<script defer src='~/plugins/jqPlot/jqplot.dateAxisRenderer.js' asp-append-version='true'></script>
	<script defer src='~/plugins/jqPlot/jqplot.canvasTextRenderer.js' asp-append-version='true'></script>
	<script defer src='~/plugins/jqPlot/jqplot.canvasAxisLabelRenderer.js' asp-append-version='true'></script>
	<script defer src='~/plugins/jqPlot/jqplot.canvasAxisTickRenderer.js' asp-append-version='true'></script>
	<script defer src='~/plugins/jqPlot/jqplot.highlighter.js' asp-append-version='true'></script>
	<script defer src='~/plugins/jqPlot/jqplot.canvasOverlay.js' asp-append-version='true'></script>
	<script defer src='~/scripts/charts/chart.js' asp-append-version='true'></script>
	<script defer src='~/scripts/charts/history/chart-line.js' asp-append-version='true'></script>
	<script defer src='~/scripts/charts/history/user-progression.js' asp-append-version='true'></script>
	<script defer src='~/scripts/charts/history/user-activity.js' asp-append-version='true'></script>
}

@section Styles {
	<link rel='stylesheet' href='~/styles/leaderboard.css' />
	<link rel='stylesheet' href='~/styles/leaderboard-player.css' />

	<link rel='stylesheet' href='~/plugins/jqPlot/jquery.jqplot.min.css' />
	<link rel='stylesheet' href='~/styles/chart.css' />
}
