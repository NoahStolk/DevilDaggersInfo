@page "/donations"
@inject PublicApiHttpClient Http
@using DevilDaggersInfo.Web.BlazorWasm.Shared.Dto.Public.Donations

<Heading>Donations</Heading>

<p>
	I've built this website and the tools that come with it entirely in my free time. If you appreciate the work I've done, or want to support hosting and domain costs for the website, you can consider <UrlLink Href="//paypal.me/NoahStolk">donating via PayPal</UrlLink>. Please be sure to include your leaderboard username, rank, or user ID (user ID can be found by hovering over your rank number on the <UrlLink Href="leaderboard">Leaderboard</UrlLink> page), so I can add you to the list of donators below, or if you prefer to stay anonymous, an alias or no name at all is fine too.
	@*TODO: When site is open source: "You can also star the project on GitHub."*@
</p>
<p>
	Thanks to everyone who donated!
</p>
<p>
	@foreach (Dagger dagger in Daggers.GetDaggers(GameVersion.V3_1))
	{
		<img src="images/icons/daggers/@(dagger.Name.ToLower()).png" style="margin: 8px;" />
	}
</p>

@if (GetDonators == null)
{
	<Loading />
}
else
{
	<div class="grid gap-3 sm:grid-cols-1 md:grid-cols-3">
		@{
			const float columns = 3f;
			int interval = (int)Math.Ceiling(GetDonators.Count / columns);
			if (interval % 2 != 0)
				interval++;

			for (int i = 0; i < GetDonators.Count; i += interval)
			{
				foreach (GetDonator donator in GetDonators.Skip(i).Take(interval))
				{
					string username = donator.HideDonations ? "(anonymous)" : donator.PlayerName;

					string tooltipText = string.Join(" + ", donator.Donations
						.GroupBy(d => d.Currency)
						.Select(g => $"{g.Key.GetChar()} {(g.Sum(d => d.Amount) / 100.0).ToString("0.00")} {(g.Key.ToString().ToUpper())}"));

					<div>
						<div style="white-space: nowrap; flex-grow: 4;" class="font-goethe devil text-xl">@username</div>
						<Tooltip Text="@tooltipText" CssClass="text-center w-full font-calibri">
							â‚¬ @((donator.Donations.Sum(d => d.ConvertedEuroCentsReceived) / 100.0).ToString("0.00"))
						</Tooltip>
					</div>
				}
			}
		}
	</div>
}

@code
{
	public List<GetDonator>? GetDonators { get; set; }

	protected override async Task OnInitializedAsync()
	{
		GetDonators = await Http.GetDonators();
	}
}
