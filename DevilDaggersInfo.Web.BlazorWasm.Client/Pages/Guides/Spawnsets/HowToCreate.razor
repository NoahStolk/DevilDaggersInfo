@page "/guides/creating-spawnsets"

<Heading Title="How To Create Spawnsets" />

<Paragraph>
	This guide assumes you already know how to use spawnsets. If you don't, please read <a class="link" href="/guides/using-spawnsets">this guide</a> first.
</Paragraph>

<Heading Level="2" Title="What Can Be Changed Using A Spawnset?" />

<ul class="pl-4">
	<li class="list-disc">The spawn time of each enemy</li>
	<li class="list-disc">The height of each tile in the arena</li>
	<li class="list-disc">The rate at which the arena shrinks, and when the shrinking stops</li>
	<li class="list-disc">The brightness</li>
	<li class="list-disc">The initial hand upgrade for the player</li>
	<li class="list-disc">The amount of additional gems given to the player when starting the run</li>
	<li class="list-disc">The timer value at the start of the run (for simulating practice more accurately)</li>
	<li class="list-disc">The game mode (only the default mode is fully supported by the game)</li>
</ul>

<Paragraph>
	All of this data can be edited using <a class="link" href="tools/survival-editor">Devil Daggers Survival Editor</a>.
</Paragraph>

<Heading Level="2" Title="Changing Enemy Spawns" />

<Paragraph>
	A spawn in the survival file is defined by an <b>enemy type</b> and a <b>delay value</b>. Every spawnset has a list of these which can be edited.
</Paragraph>

<Heading Level="3" Title="Enemy Types" />

<Paragraph>
	10 enemies can be spawned in the survival file:
</Paragraph>

<ul class="pl-4">
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Squid1)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Squid2)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Centipede)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Spider1)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Leviathan)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Gigapede)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Squid3)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Thorn)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Spider2)</li>
	<li class="list-disc">@MarkupUtils.EnemyString(EnemiesV3_2.Ghostpede)</li>
	<li class="list-disc">Empty</li>
</ul>

<Heading Level="3" Title="Delay Values" />

<Paragraph>
	The delay value specifies the amount of seconds the game will wait before spawning the enemy. Consider the following list of spawns:
</Paragraph>

<div class="grid grid-cols-3 max-w-sm border-2 border-gray-5 px-1">
	<div class="font-bold">Enemy type</div>
	<div class="font-bold text-right">Delay value</div>
	<div class="font-bold text-right">Spawn time</div>
	@{
		float time = 0;
		foreach ((Enemy enemy, float delay) in new[] { (EnemiesV3_2.Squid1, 4), (EnemiesV3_2.Spider1, 3) })
		{
			time += delay;

			<div>@MarkupUtils.EnemyString(enemy)</div>
			<div class="text-right">@delay.ToString(FormatUtils.TimeFormat)</div>
			<div class="text-right">@time.ToString(FormatUtils.TimeFormat)</div>
		}
	}
</div>

<Paragraph>
	When the run begins, the game will wait 4 seconds before spawning the first @MarkupUtils.EnemyString(EnemiesV3_2.Squid1). After that, it will wait 3 seconds before spawning the @MarkupUtils.EnemyString(EnemiesV3_2.Spider1), so the @MarkupUtils.EnemyString(EnemiesV3_2.Spider1) will spawn at 7 seconds.
</Paragraph>

<Paragraph>
	To spawn multiple enemies at the same time, simply use a delay value of 0:
</Paragraph>

<div class="grid grid-cols-3 max-w-sm border-2 border-gray-5 px-1">
	<div class="font-bold">Enemy type</div>
	<div class="font-bold text-right">Delay value</div>
	<div class="font-bold text-right">Spawn time</div>
	@{
		time = 0;
		foreach ((Enemy enemy, float delay) in new[] { (EnemiesV3_2.Squid2, 2), (EnemiesV3_2.Gigapede, 5), (EnemiesV3_2.Gigapede, 0), (EnemiesV3_2.Gigapede, 0), (EnemiesV3_2.Spider1, 3) })
		{
			time += delay;

			<div>@MarkupUtils.EnemyString(enemy)</div>
			<div class="text-right">@delay.ToString(FormatUtils.TimeFormat)</div>
			<div class="text-right">@time.ToString(FormatUtils.TimeFormat)</div>
		}
	}
</div>

<Heading Title="The End Loop" Level="3" />
<Paragraph>
	The end loop is the same set of spawns over and over again, faster every time. This appears at the end of the spawnset.
</Paragraph>
<Paragraph>
	You might have noticed how there is an <b>Empty</b> enemy type. This enemy type does not spawn an enemy; its only purpose is to mark the beginning of the end loop. The last <b>Empty</b> spawn will always mark the beginning of the end loop. Having an end loop is optional, so if you don't want to include an end loop, simply make sure to put an <b>Empty</b> spawn at the end of the spawnset to mark the end of the spawnset (or literally; mark the start of an empty end loop).
</Paragraph>
<Paragraph>
	Every third wave of the end loop, all @MarkupUtils.EnemyString(EnemiesV3_2.Gigapede, true) are changed into @MarkupUtils.EnemyString(EnemiesV3_2.Ghostpede, true). This is hardcoded in the game and cannot be changed.
</Paragraph>

<Heading Level="3" Title="End Loop Speed Up" />
<Paragraph>
	How the end loop speeds up is also hardcoded in the game. How it works exactly is a bit hard to explain however... In the game there is an additional "special" timer used for the end loop. This timer initially increases the same amount as the normal timer, so during the first wave, all the enemies spawn at the exact same speed as they would before the end loop.
</Paragraph>
<Paragraph>
	The speed up happens after every wave ends; at that point the special timer is sped up by a very small amount. The exact amount for this is 12.5% of a 60th of a second (a game tick), which is 0.0020833 seconds. This means that during the second wave, the special timer increases by 0.0020833 seconds more than the normal timer for every game tick, then 0.0041667 seconds more during the third wave, etc.
</Paragraph>
<Paragraph>
	Here is the data for the first 10 waves in the original game:
</Paragraph>

<div class="grid grid-cols-4 sm:grid-cols-5 border-2 border-gray-5 px-1">
	<div class="font-bold text-right hidden sm:block">Wave index</div>
	<div class="font-bold text-right">Wave start</div>
	<div class="font-bold text-right">Wave length</div>
	<div class="font-bold text-right">Decrement (relative to previous)</div>
	<div class="font-bold text-right">Speed up</div>

	@{
		const double physicsTick = 1f / 60f;

		int[] loopSeconds = new int[] { 5, 8, 11, 16, 21, 22, 23, 33, 34, 35, 40, 41, 46, 51, 56 };

		double waveModifier = 0f;
		double seconds = 451f;

		double previousLength = 0;
		for (int i = 0; i < 10; i++)
		{
			double start = seconds;
			double enemyTimer = 0f;
			for (int j = 0; j < loopSeconds.Length; j++)
			{
				while (enemyTimer < loopSeconds[j])
				{
					seconds += physicsTick;
					enemyTimer += physicsTick + waveModifier;
				}
			}

			double length = seconds - start;

			<div class="text-right hidden sm:block">@i</div>
			<div class="text-right">@((Math.Floor(start * 60) / 60).ToString(FormatUtils.TimeFormat))</div>
			<div class="text-right">@((Math.Floor(length * 60) / 60).ToString(FormatUtils.TimeFormat))</div>
			<div class="text-right">@(previousLength == 0 ? "-" : (1 - length / previousLength).ToString("0.00%"))</div>
			<div class="text-right">@(waveModifier.ToString("0.0000000"))</div>

			waveModifier += physicsTick / 8f;
			previousLength = length;
		}
	}
</div>

<Heading Title="Using The Editor" Level="3" />

<Paragraph>
	Now that the theory is out of the way. We can start using the editor to change the spawns in a spawnset. A good way to start is by adding spawns to an empty spawnset.
</Paragraph>

<Paragraph>
	In the bottom left of the editor you can select an enemy type to spawn, and change the delay value in the text box below. Click the "Add" button to add the spawn to the list. Try adding a few spawns to the spawnset.
</Paragraph>

<img src="/images/tools/ddse-adding-spawns.png" class="object-contain max-h-160" />

<Paragraph>
	If you want to remove a spawn, you can select it and click the "Delete selected spawn(s)" button. You can also change the enemy type of a spawn by selecting it, setting the new enemy type, and clicking the "Edit selected spawn(s)" button.
</Paragraph>

<img src="/images/tools/ddse-editing-spawns.png" class="object-contain max-h-160" />

<Paragraph>
	Available keyboard shortcuts that can be used for the spawns list:
</Paragraph>

<ul class="pl-4">
	<li class="list-disc"><pre class="code">Del</pre> to delete selected spawns</li>
	<li class="list-disc"><pre class="code">Ctrl C</pre> to copy selected spawns</li>
	<li class="list-disc"><pre class="code">Ctrl V</pre> to paste spawns</li>
	<li class="list-disc"><pre class="code">Ctrl A</pre> to select all spawns</li>
</ul>

<Heading Title="Changing The Arena" Level="2" />

<Paragraph>
	Here is some basic information you need to know in order to work with the arena:
</Paragraph>

<ul class="pl-4">
	<li class="list-disc">The arena is simply a grid of heights. You cannot have multiple tiles above or below each other.</li>
	<li class="list-disc">The arena size always consists of 51 by 51 tiles (at least in the editor, this can be changed in theory but I haven't tried it).</li>
	<li class="list-disc">The player always spawns in the middle (tile 25x25).</li>
	<li class="list-disc">Tiles are 4 by 4 units in length and width.</li>
	<li class="list-disc">The arena shrinks in size as time goes on. The default shrink start radius is 50 units and the default shrink end radius is 20 units. The default shrink rate is 0.025. This means the default arena reaches the end radius at 1200 seconds, because (50-20)/0.025 = 1200. (Even though the last tiles actually fall down at around 1187 seconds, the shrinking technically continues for about 13 seconds, it's just that no tiles are affected by it.)</li>
	<li class="list-disc">The default tile height is height 0.</li>
	<li class="list-disc">Tiles will fall down when their height is below -1.</li>
	<li class="list-disc">The tile at coordinate {1, 0} is always invisible for some reason, but you can still walk on it.</li>
	<li class="list-disc">Enemies and gems do not react to different tile heights. Only the player, the daggers, and some effects do (like @MarkupUtils.EnemyString(EnemiesV3_2.Thorn) spawn smokes, meat chunks, etc).</li>
	<li class="list-disc">The tiles have infinitely long "hitboxes" (there are no actual hitboxes, things just collide with the tile based on its height).</li>
	<li class="list-disc">The texture only covers the top of the tile. You can however work around this by using mods that change the pillar model.</li>
</ul>
