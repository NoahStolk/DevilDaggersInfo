@page "/custom/mod/{Id:int}"
@inject PublicApiHttpClient Http
@inject NavigationManager NavigationManager
@using DevilDaggersInfo.Web.BlazorWasm.Shared.Dto.Public.Mods
@using DevilDaggersInfo.Web.BlazorWasm.Shared.Enums

@if (GetMod == null)
{
	<Loading />
}
else
{
	<Heading>Mod - @GetMod.Name</Heading>

	<div class="bg-gray-0b max-w-sm px-1">
		<DataField Name="Author(s)">@string.Join(", ", GetMod.Authors)</DataField>
		<DataField Name="Last updated">@GetMod.LastUpdated.ToString(FormatUtils.DateTimeFormat)</DataField>
		<DataField Name="Prohibited assets">@(GetMod.ContainsProhibitedAssets.HasValue ? GetMod.ContainsProhibitedAssets.Value ? "Yes" : "No" : "Unknown")</DataField>
		@if (GetMod.ModArchive != null)
		{
			<DataField Name="File size">@FileSizeUtils.Format(GetMod.ModArchive.FileSize)</DataField>
			<DataField Name="File size (extracted)">@FileSizeUtils.Format(GetMod.ModArchive.FileSizeExtracted)</DataField>
		}

		<div class="grid grid-cols-2 text-lg">
			<div class="px-1 py-3">
				<UrlLink Href="@($"/api/mods/{GetMod.Name}/file")">Download mod</UrlLink>
			</div>
		</div>
	</div>

	@if (!string.IsNullOrWhiteSpace(GetMod.HtmlDescription))
	{
		<Heading Level="2">Description</Heading>
		<div class="bg-gray-22 max-w-sm px-1">
			@((MarkupString)@GetMod.HtmlDescription)
		</div>
	}

	@*TODO: Screenshots and trailer*@

	@if (GetMod.ModArchive != null)
	{
		<Heading Level="2">Binaries</Heading>
		<div class="bg-gray-22 grid gap-3 sm:grid-cols-mod-binaries-sm md:grid-cols-mod-binaries-md lg:grid-cols-mod-binaries-lg xl:grid-cols-mod-binaries-xl">
			<div>Name</div>
			<div class="hidden lg:block">Size (extracted)</div>
			<div class="hidden lg:block">Assets</div>
			<div class="hidden md:block">Prohibited assets</div>
		</div>
		@foreach (GetModBinary binary in GetMod.ModArchive.Binaries)
		{
			<div class="grid gap-3 grid-cols-5 odd:bg-gray-16 sm:grid-cols-mod-binaries-sm md:grid-cols-mod-binaries-md lg:grid-cols-mod-binaries-lg xl:grid-cols-mod-binaries-xl">
				<div>@binary.Name</div>
				<div class="hidden lg:block">@FileSizeUtils.Format(binary.Size)</div>
				<div class="hidden lg:block">@binary.Assets.Count</div>
				<div class="hidden md:block">@(binary.ContainsProhibitedAssets ? "Yes" : "No")</div>
			</div>
		}

		<Heading Level="2">Assets</Heading>
		@foreach (GetModBinary binary in GetMod.ModArchive.Binaries)
		{
			<Heading Level="3">@binary.Name</Heading>
			<div class="max-w-sm px-1">
				@foreach (IGrouping<Core.Asset.Enums.AssetType, GetModAsset> assetGroup in binary.Assets.GroupBy(mad => mad.Type))
				{
					<Heading Level="4">@assetGroup.Key assets</Heading>
					@foreach (GetModAsset asset in assetGroup)
					{
						<DataField CssClass="odd:bg-gray-16" Name="@asset.Name">@FileSizeUtils.Format(asset.Size)</DataField>
					}
				}
			</div>
		}
	}
}

@code
{
	[Parameter, EditorRequired] public int Id { get; set; }

	public GetMod? GetMod { get; set; }

	protected override async Task OnInitializedAsync()
	{
		GetMod = await Http.GetModById(Id);
	}
}
