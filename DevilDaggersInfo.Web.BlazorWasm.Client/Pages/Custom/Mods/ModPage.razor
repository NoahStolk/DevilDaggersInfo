@page "/custom/mod/{Id:int}"
@inject PublicApiHttpClient Http
@inject NavigationManager NavigationManager
@using DevilDaggersInfo.Web.BlazorWasm.Shared.Dto.Public.Mods
@using DevilDaggersInfo.Web.BlazorWasm.Shared.Enums

@if (GetMod == null)
{
	<Loading />
}
else
{
	<Heading>Mod - @GetMod.Name</Heading>

	<div class="bg-gray-0b max-w-sm px-1">
		<DataField Name="Author(s)">@string.Join(", ", GetMod.Authors)</DataField>
		<DataField Name="Last updated">@GetMod.LastUpdated.ToString(FormatUtils.DateTimeFormat)</DataField>
		<DataField Name="Prohibited assets">@(GetMod.ContainsProhibitedAssets.HasValue ? GetMod.ContainsProhibitedAssets.Value ? "Yes" : "No" : "Unknown")</DataField>
		@if (GetMod.ModArchive != null)
		{
			<DataField Name="File size">@FileSizeUtils.Format(GetMod.ModArchive.FileSize)</DataField>
			<DataField Name="File size (extracted)">@FileSizeUtils.Format(GetMod.ModArchive.FileSizeExtracted)</DataField>
		}

		<div class="grid grid-cols-2 text-lg">
			<div class="px-1 py-3">
				<UrlLink Href="@($"/api/mods/{GetMod.Name}/file")">Download mod</UrlLink>
			</div>
		</div>
	</div>

	@if (!string.IsNullOrWhiteSpace(GetMod.HtmlDescription))
	{
		<Heading Level="2">Description</Heading>
		<div class="bg-gray-22 max-w-sm px-1">
			@((MarkupString)@GetMod.HtmlDescription)
		</div>
	}

	@*TODO: Screenshots and trailer*@

	@if (GetMod.ModArchive != null)
	{
		<Heading Level="2">Binaries</Heading>
		<div class="bg-gray-22 grid gap-3 grid-cols-5">
			<div>Type</div>
			<div>Name</div>
			<div>Size (extracted)</div>
			<div>Assets</div>
			<div>Prohibited assets</div>
		</div>
		@foreach (GetModBinary binary in GetMod.ModArchive.Binaries)
		{
			<div class="grid gap-3 grid-cols-5 odd:bg-gray-16">
				<div>@binary.ModBinaryType</div>
				<div>@binary.Name</div>
				<div>@FileSizeUtils.Format(binary.Size)</div>
				<div>@binary.Assets.Count</div>
				<div>@(binary.ContainsProhibitedAssets ? "Yes" : "No")</div>
			</div>
		}

		<Heading Level="2">Assets</Heading>
		@foreach (GetModBinary binary in GetMod.ModArchive.Binaries)
		{
			<Heading Level="3">@binary.Name</Heading>
			<div class="max-w-sm px-1">
				@foreach (GetModAsset asset in binary.Assets)
				{
					<DataField CssClass="odd:bg-gray-16" Name="@asset.Name">@FileSizeUtils.Format(asset.Size)</DataField>
				}
			</div>
		}
	}
}

@code
{
	[Parameter, EditorRequired] public int Id { get; set; }

	public GetMod? GetMod { get; set; }

	protected override async Task OnInitializedAsync()
	{
		GetMod = await Http.GetModById(Id);
	}
}
