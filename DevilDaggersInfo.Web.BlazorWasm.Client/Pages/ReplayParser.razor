@page "/replay-parser/{Id:int}"
@using DevilDaggersInfo.Core.Replay.Events

<Heading Level="1" Title="Replay Parser" />

@if (_notFound)
{
	<div>Replay not found.</div>
}
else if (_events == null)
{
	<Loading />
}
else
{
	<div>Processing took @_processingTimeInMs ms</div>

	bool f = _currentSecond <= 0;
	bool l = _currentSecond >= _events.Count / 60;
	const string disabledStyle = "disabled:opacity-50 cursor-default btn-disabled";
	const string enabledStyle = "btn-gray-light";

	<div class="flex">
		<div class="w-10 h-10 mx-1">
			<button disabled="@f" class="@(f ? disabledStyle : enabledStyle) btn" @onclick="() => _currentSecond = 0">@MarkupUtils.NavStart</button>
		</div>
		<div class="w-10 h-10 mx-1">
			<button disabled="@f" class="@(f ? disabledStyle : enabledStyle) btn" @onclick="() => _currentSecond = Math.Max(0, _currentSecond - 5)">@MarkupUtils.NavPrevDouble</button>
		</div>
		<div class="w-10 h-10 mx-1">
			<button disabled="@f" class="@(f ? disabledStyle : enabledStyle) btn" @onclick="() => _currentSecond = Math.Max(0, _currentSecond - 1)">@MarkupUtils.NavPrev</button>
		</div>
		<div class="w-10 h-10 mx-1">
			<button disabled="@l" class="@(l ? disabledStyle : enabledStyle) btn" @onclick="() => _currentSecond = Math.Min(_events.Count / 60, _currentSecond + 1)">@MarkupUtils.NavNext</button>
		</div>
		<div class="w-10 h-10 mx-1">
			<button disabled="@l" class="@(l ? disabledStyle : enabledStyle) btn" @onclick="() => _currentSecond = Math.Min(_events.Count / 60, _currentSecond + 5)">@MarkupUtils.NavNextDouble</button>
		</div>
		<div class="w-10 h-10 mx-1">
			<button disabled="@l" class="@(l ? disabledStyle : enabledStyle) btn" @onclick="() => _currentSecond = _events.Count / 60">@MarkupUtils.NavEnd</button>
		</div>
	</div>

	<ul class="pl-4">
		@for (int i = _currentSecond * 60; i < Math.Min(_events.Count, (_currentSecond + 1) * 60); i++)
		{
			<li class="list-disc">
				<span>Tick @i (@((i / 60f).ToString(FormatUtils.TimeFormat)))</span>
				<ul class="pl-4">
					@foreach (IEvent e in _events[i])
					{
						<li class="list-disc">@e.ToString()</li>
					}
				</ul>
			</li>
		}
	</ul>
}
