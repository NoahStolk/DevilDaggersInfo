@page
@using DevilDaggersCore.Game
@using DevilDaggersWebsite.Code.Donations
@*using DevilDaggersWebsite.Code.Utils.Web*@
@{
	ViewData["Title"] = "Donations";

	int[] widths = new int[4] { 256, 128, 20, 52 };
}

<header>
	<h1>@ViewData["Title"]</h1>
</header>

<main role="main" class="text-center">
	<p>
		I've built this website and the tools that come with it entirely in my free time. If you appreciate the work I've done, or want to support hosting and domain costs for the website, you can consider <a href="http://paypal.me/NoahStolk">donating via PayPal</a>. Please be sure to include your username so I can add you to the list of donators below.
	</p>
	<p>
		Thanks to everyone who donated.
	</p>
	<p>
		@foreach (Dagger dagger in GameInfo.GetEntities<Dagger>())
		{
			<img src="~/Images/Daggers/@(dagger.Name)Small.png" />
		}
	</p>

	<div class="flex-container flex-center flex-column">
		@{
			foreach (KeyValuePair<int, int> kvp in DonationList.DonatorsWithReceivedEuroAmounts.OrderByDescending(kvp => kvp.Value).ThenBy(kvp => DonationList.Donators.FirstOrDefault(d => d.Id == kvp.Key).UsernameFallback))
			{
				Donator donator = DonationList.Donators.FirstOrDefault(d => d.Id == kvp.Key);
				string username = donator.IsAnonymous ? "(anonymous)" : donator.UsernameFallback;
				@*
					string username;
					if (donator.IsAnonymous)
					{
						username = "(anonymous)";
					}
					else if (donator.Id == 0)
					{
						username = donator.UsernameFallback;
					}
					else
					{
						username = (await Hasmodai.GetUserById(donator.Id)).Username;
					}
				*@

				string currency = DonationList.Donations.FirstOrDefault(d => d.DonatorId == kvp.Key).Currency;
				int amount = DonationList.Donations.Where(d => d.DonatorId == kvp.Key).Sum(d => d.Amount);

				<div class="flex-container flex-center">
					<div style="width: @(widths[0])px; white-space: nowrap;" class="text-left devil">@username</div>
					<div style="width: @(widths[1])px;" class="text-right devil">@((amount / 100.0).ToString("0.00"))</div>
					<div style="width: @(widths[2])px;" class="text-right devil">@(DonationList.CurrencyChars[currency])</div>
					<div style="width: @(widths[3])px;" class="text-right devil">
						(@currency)
					</div>
				</div>
			}
		}
	</div>
</main>