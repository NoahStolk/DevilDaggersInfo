@using DevilDaggersCore.Game
@using DevilDaggersWebsite.BlazorWasm.Shared.Dto.Public.Leaderboards
@using DevilDaggersWebsite.BlazorWasm.Shared.Dto.Public.Players

<div class="text-xl font-goethe">
	<div class="grid gap-3 sm:grid-cols-leaderboard-sm md:grid-cols-leaderboard-md lg:grid-cols-leaderboard-lg xl:grid-cols-leaderboard-xl">
		<div class="text-right"><Tooltip Text="Rank">#</Tooltip></div>
		<div class="text-left"><Tooltip Text="Flag"><img src="/images/icons/custom-x2/flag.png" /></Tooltip></div>
		<div class="text-left"><Tooltip Text="Player"><img src="/images/icons/mask-x2/eye.png" /></Tooltip></div>
		<div class="text-right"><Tooltip Text="Time"><img src="/images/icons/mask-x2/stopwatch.png" /></Tooltip></div>
		<div class="text-right hidden sm:block"><Tooltip Text="Kills"><img src="/images/icons/mask-x2/dagger.png" /></Tooltip></div>
		<div class="text-right hidden sm:block"><Tooltip Text="Gems"><img src="/images/icons/mask-x2/gem.png" /></Tooltip></div>
		<div class="text-right hidden sm:block"><Tooltip Text="Accuracy"><img src="/images/icons/mask-x2/crosshair.png" /></Tooltip></div>
		<div class="text-left hidden lg:block"><Tooltip Text="Death type"><img src="/images/icons/mask-x2/skull.png" /></Tooltip></div>
		<div class="text-right hidden lg:block"><Tooltip Text="Total time"><img src="/images/icons/mask-x2/stopwatch.png" /></Tooltip></div>
		<div class="text-right hidden lg:block"><Tooltip Text="Total kills"><img src="/images/icons/mask-x2/dagger.png" /></Tooltip></div>
		<div class="text-right hidden lg:block"><Tooltip Text="Total gems"><img src="/images/icons/mask-x2/gem.png" /></Tooltip></div>
		<div class="text-right hidden lg:block"><Tooltip Text="Total accuracy"><img src="/images/icons/mask-x2/crosshair.png" /></Tooltip></div>
		<div class="text-right hidden lg:block"><Tooltip Text="Total deaths"><img src="/images/icons/mask-x2/skull.png" /></Tooltip></div>
	</div>
	<div>
		@{
			int i = 0;

			foreach (GetEntry entry in Leaderboard.Entries)
			{
				GetPlayerForLeaderboard? player = Players?.Find(p => p.Id == entry.Id);
				bool isBanned = player?.IsBanned ?? false;

				Dagger dagger = GameInfo.GetDaggerFromSeconds(_gameVersion, entry.Time);
				string daggerCssClass = dagger.Name.ToLower();

				Death? death = GameInfo.GetDeathByType(_gameVersion, (int)entry.DeathType);
				string deathStyle = isBanned ? string.Empty : $"color: #{death?.ColorCode ?? "444"};";
				string deathName = death?.Name ?? "Unknown";

				double accuracy = entry.DaggersFired == 0 ? 0 : entry.DaggersHit / (double)entry.DaggersFired;
				double accuracyTotal = entry.DaggersFiredTotal == 0 ? 0 : entry.DaggersHitTotal / (double)entry.DaggersFiredTotal;

				string daggers = FormatUtils.FormatDaggersInt32(entry.DaggersHit, entry.DaggersFired, IsHistory);
				string daggersTotal = FormatUtils.FormatDaggersUInt64(entry.DaggersHitTotal, entry.DaggersFiredTotal, IsHistory);

				<div class="grid gap-3 sm:grid-cols-leaderboard-sm md:grid-cols-leaderboard-md lg:grid-cols-leaderboard-lg xl:grid-cols-leaderboard-xl h-6 @(i % 2 == 0 ? "bg-gray0B" : string.Empty) @(isBanned ? "text-color-ban" : string.Empty)">
					<EntryRank PlayerId="@entry.Id" Rank="@entry.Rank" />
					<EntryFlag CountryCode="@player?.CountryCode" />
					<EntryUsername DaggerCssClass="@daggerCssClass" Id="entry.Id" Name="@entry.Username" BanDescription="@player?.BanDescription" IsBanned="isBanned" IsPublicDonator="player?.IsPublicDonator ?? false" Titles="player?.Titles" />
					<div class="text-right @(isBanned ? string.Empty : daggerCssClass)">@entry.Time.ToString(FormatUtils.TimeFormat)</div>
					<div class="text-right hidden sm:block">@entry.Kills.ToString(FormatUtils.LeaderboardIntFormat)</div>
					<div class="text-right hidden sm:block">@entry.Gems.ToString(FormatUtils.LeaderboardIntFormat)</div>
					<div class="text-right hidden sm:block">
						<Tooltip Text="@daggers">@accuracy.ToString(FormatUtils.AccuracyFormat)</Tooltip>
					</div>
					<div class="text-left hidden lg:block" style="@deathStyle">@deathName</div>
					<div class="text-right hidden lg:block">@entry.TimeTotal.ToString(FormatUtils.LeaderboardGlobalTimeFormat)</div>
					<div class="text-right hidden lg:block">@entry.KillsTotal.ToString(FormatUtils.LeaderboardIntFormat)</div>
					<div class="text-right hidden lg:block">@entry.GemsTotal.ToString(FormatUtils.LeaderboardIntFormat)</div>
					<div class="text-right hidden lg:block">
						<Tooltip Text="@daggersTotal">@accuracyTotal.ToString(FormatUtils.AccuracyFormat)</Tooltip>
					</div>
					<div class="text-right hidden lg:block">@entry.DeathsTotal.ToString(FormatUtils.LeaderboardIntFormat)</div>
				</div>

				i++;
			}
		}
	</div>
</div>

@code
{
	[Parameter] public bool IsHistory { get; set; }
	[Parameter] public GetLeaderboard Leaderboard { get; set; } = null!;
	[Parameter] public List<GetPlayerForLeaderboard>? Players { get; set; } = null!;

	private GameVersion _gameVersion;

	protected override void OnInitialized()
	{
		_gameVersion = GameInfo.GetGameVersionFromDate(Leaderboard.DateTime) ?? GameVersion.V1;
	}
}
